<p id="notice"><%= notice %></p>

<script>
$('#search-box').keyup(function(evt) {
  // get keycode of current keypress event
  var code = (evt.keyCode || evt.which);

  // do nothing if it's an arrow key
  if(code == 37 || code == 38 || code == 39 || code == 40) {
    return;
  }

  var searchDropdown = document.getElementById("autocomp");
  var search = document.getElementById("search-box");
  var textVal = search.value;
  
  $.ajax({
    type:'PUT',
    url:'/search',
    data: { _method:'PUT', text : textVal },
    success:function(resp){
      //remove old search suggestions
      while(searchDropdown.firstChild) {
        searchDropdown.removeChild(searchDropdown.firstChild);
      }

      //add new suggestions
      resp.forEach(function(respCar) {
        var option = document.createElement('option');
        option.value = respCar.make;
        searchDropdown.appendChild(option);
      });
    }
  });
});

</script>

<form>
  <input type="text" name="search" id="search-box" autocomplete="off" list="autocomp">
  <datalist id="autocomp">
  </datalist>
  <input type="submit" value="Search">
</form>

<p>Cars: <strong><%= @cars.size %></strong></p>
<table class="table table-striped">
  <thead>
    <tr>
      <th>Year</th>
      <th>Make</th>
      <th>Model</th>
      <th>Build Cost</th>
      <th></td>
    </tr>
  </thead>
  <tbody>
    <% @cars.each do |car| %>
      <tr>
        <td><%= car.year %></td>
        <td><%= car.make %></td>
        <td><%= car.model %></td>
        <td>$<%= number_with_delimiter(car.build_cost, :delimiter => ',') %></td>
        <td>
          <div class="btn-group" role="group">
            <%= link_to 'View', car, :class => "btn btn-primary" %>
            <%= link_to 'Edit', edit_car_path(car), :class => "btn btn-primary" %>
            <%= link_to 'Delete', car, method: :delete, data: { confirm: 'Are you sure you want to delete this car?' }, :class => "btn btn-primary" %>
          </div>
        </td>
      </tr>
    <% end %>
  </tbody>
</table>

<br>
